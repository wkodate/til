# 9. Serving Data For Analytics, Machine Learning, And Reverse ETL

データエンジニアが遭遇するであろう3つの主要なユースケースに対してデータを提供する様々な方法

1. アナリティクスとBIツールへのデータ提供
2. MLアプリケーションへのデータ提供
3. リバースETL

## 9.1 General Considerations for Serving Data

データ提供に関する重要な検討事項

- 信頼
- ユースケースとユーザ
- データプロダクト
- データ提供方法 (セルフサービスかどうか)
- データ定義とロジック
- データメッシュ

### 9.1.1 Trust

データプロダクトが常に高品質で信頼できるデータを提供できるようにしなければならない。

データ品質を実現するためには、データ検証やデータ可観測性プロセスを活用する。

データ検証は、データを分析して財務情報、顧客とのやり取り、売上が正確に表されているかどうかを確認する。

データ可観測性は、データをデータプロセスの継続的なビューを提供する。

また、SLAやSLOに対する信頼を構築する。

### 9.1.2 What’s the Use Case, and Who’s the User?

ユースケースはなにか、ユーザは誰かを考慮する。

可能な限りROIの高いユースケースを優先する。

データプロジェクトを始めるときの質問

- データを使うのは誰か、データはどのように使われるか。
- 利害関係者は何を期待しているか。
- 利害関係者とどのように協力すれば、データの利用のされ方を知ることができるか。

### 9.1.3 Data Products

データプロダクトの利用が増える → より有用なデータが作られる → それがデータプロダクトの改善に使われる、の良いフィードバックループを作る。

データプロダクトを作る際に留意すること

- そのデータプロダクトの利用者が達成したいことはなにか
- そのデータプロダクトは内部ユーザと外部ユーザのどりたに役立つか
- 構築するデータプロダクトのせいかとROIは何か

### 9.1.4 Self-Service or Not?

すべてのユーザがセルフサービスを求めているわけではない。ビジネスの状況を理解したい経営幹部は、ただダッシュボードがほしいだけなのでセルフサービスツールは不要。

セルフサービスのデータプロジェクトを成功させるために、適切な利用者を確保し、セルフサービスのユーザと彼らがやりたいことを明確にする。

### 9.1.5 Data Definitions and Logic

データの正確さには、適切なデータ定義とデータロジックが含まれる。

データの定義とは、組織全体で理解されるデータの意味を指す。部門で定義が異なる場合は、データ利用者のためにそれを文書化しなければならない。

データロジックとは、データからメトリクスを導き出すための公式を規定するもの。データ定義と統計計算の詳細の定義が必要。

### 9.1.6 Data Mesh

集中型ではなく分散型で、各ドメインで自分たちのデータを消費できるように準備し、他チームにデータを提供する。

各チームはダッシュボードやアナリティクスをセルフサービスで実行する場合がある。

## 9.2 Analytics

アナリティクスとは、データの中から重要な洞察パターンを発見し、探索し、特定し、可視化すること。

アナリティクスのためにデータを提供する方法を示し、アナリストの成功を助けるために考えるべきポイントの紹介。

- ビジネスアナリティクス (BI)
- オペレーショナルアナリティクス
- 組み込みアナリティクス

### 9.2.1 Business Analytics

ビジネスアナリティクスは、実行可能な戦略的な意思決定を行うために、過去と現在のデータを使用する。

ビジネスアナリティクスの分類

- ダッシュボード
- レポート
- アドホック分析

ダッシュボードは、意思決定者に対して主要なメトリクスに対する組織のパフォーマンスを示す。ダッシュボードを作成するプラットフォームは、Tableau、Looker、Sisense、Power BI、Apache Superset/Presetなど。

レポートは、データを使って洞察と行動を促す。ダッシュボードと同じBIツールで提供される。

アドホック分析は、レポートの最初のフェーズで実施され、結果が影響力の強いものであればレポートやダッシュボードにまとめられる。Excel、Python、Rのnotebook、SQLクエリ。

### 9.2.2 Operational Analytics

ビジネスアナリティクスは、データを使って「実行可能な知見を得る」が、オペレーショナルアナリティクスはデータを使って「即座に実行する」。

問題が発生したら即座に対処しなければならない、リアルタイムのアプリケーション監視など。

### 9.2.3 Embedded Analytics

組み込みアナリティクスは、エンドユーザ向けのダッシュボード。

低レイテンシ、高速なクエリ性能、高い並行性が求められる。

## 9.3 Machine Learning

ML、データサイエンス、データエンジニアリング、MLエンジニアリングの協会は曖昧。組織のよって担当範囲が大きく異なる。

## 9.4 What a Data Engineer Should Know About ML

古典的なMLの仕組みやディープラーニングの基礎を知っておくことは非常に役立つ。

データサイエンティストと一緒にデータプロダクトを構築するうえで大いに助けになる。

## 9.5 Ways to Serve Data for Analytics and ML

アナリティクスやMLにデータを提供する一般的な方法

- ファイル
- データベース
- クエリエンジン
- データ共有

### 9.5.1 File Exchange

データを処理してファイルを生成し、そのファイルを渡す。

データ消費者がデータ共有プラットフォームを使用できない場合に、ファイルでデータを提供しなければならない場合が多い。

ファイルのバージョンの一貫性を保ちたいなら、Google Docsなどのコラボレーションプラットフォームを使おう。

### 9.5.2 Databases

ここでのデータベースは、OLAPデータベース (データウェアハウスやデータレイク) のこと。

データベースからのデータ提供は、スキーマがある、アクセスコントロールができる、計算量の大きいクエリを高性能・高並列で処理できる、などの利点がある。

ETLと、アナリティクスやデータサイエンス向けのデータ提供など、主要なユースケース事にクラスタは分離したほうがいい。これによって、データエンジニアリングチームの管理下で、個々のチームがクエリコストの予算を立てることが可能になる。

### 9.5.3 Streaming Systems

OLAPデータベースとストリーム処理システムを組み合わせて、最新のデータを含む広範囲の履歴データにわたってクエリを実行することができる。

### 9.5.4 Query Federation

フェデレーションを用いると、面倒なデータパイプラインやETLの設定を行わずに、さまざまなシステムからのデータを混ぜ合わせたデータに対するアドホックなクエリを用いた分析が可能になる。

クエリフェデレーションが実運用システムのソースシステムにアクセスする場合、ソースシステムんおリソースを過度に消費しすぎないように注意する。

### 9.5.5 Data Sharing

ここでのデータ共有は、クラウド環境における大規模なマルチテナントストレージシステムを通じた共有を指す。

セキュリティとアクセス制御が大きく関わってくる。

### 9.5.6 Semantic and Metrics Layers

クエリ品質は、ビジネス上の質問に対して正確な答えを返すような適切なロジックを持つクエリの作成方法の問題。

メトリクスレイヤIは、ビジネスロジックを管理し計算するためのツール。

Lokker, dbt (data build tool) などのソフトウェアが使われる。

### 9.5.7 Serving Data in Notebooks

データサイエンティストはノートブックを頻繁に用いる。

データサイエンティストには、ノートPCではなく、クラウドの計算能力とスケーラビリティを利用してもらう。そのためのバージョンやアップデート管理、アクセス制御、SALの維持などの運用を行う。

## 9.6 Reverse ETL

リバースETLは、OLAPデータベースからソースシステムにデータをロードして戻す。

既製のETLソリューションが多くあるのでオープンソースや商用のマネージドサービスを使おう。

リバースETLによって生み出されるフィードバックループによって、結果が予期せず増大しないように監視する。

## 9.7 Whom You’ll Work With

データアナリスト、データサイエンティスト、MLOps/MLエンジニア、ビジネス関係者。

データエンジニアはこれらのステークホルダーをサポートする役割。可能な限り高品質のデータプロダクトを作成することに責任を持つ。

## 9.8 Undercurrents

セキュリティ: 最小権限の原則。使用されていないデータプロダクトの共有の廃止。

Data Management: 高品質で信頼できるデータにアクセスできるようにする。データ品質、ガバナンス、セキュリティ。セマンティクスレイヤとメトリクスレイヤをデータ提供レイヤに取り込む。

DataOps: Data Managementで述べられたデータ品質、ガバナンス、セキュリティの監視。

データアーキテクチャ: ユーザが必要なときに必要なデータにできるだけ早くアクセスできるようにする。フィードバックループを速く回せるようにする。データサイエンティストへのクラウド環境への促しをする。

オーケストレーション: オーケストレーションツールは集中型か、非集中型か。集中型の場合、誰がそれを管理するのか。

ソフトウェアエンジニアリング:  データ提供のフレームワークがどのように機能し、データがどのように配送されるかを知る必要がある。コードとクエリがストレージシステムに対してどのように実行されるかを理解する。
